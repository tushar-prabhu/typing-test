<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" href="./assets/ignitra_logo_icon.png" type="image/icon type">
  <title>Typing Test</title>
  <link rel="stylesheet" href="./style.css" />
</head>

<body oncontextmenu="return false">
  <noscript><h1 style="height:83vh; background-color:wheat;display:flex;align-items:center;justify-content:center;">Please enable JavaScript in your browser</h1><style>.container{display: none;}</style></noscript>
  <!--<div id="snow"></div>-->
    <div class="navbar" style="z-index: 1;">
      <p class="header"><span class="gradient-text">IGNITRA - 2k22</span> <span class="nm">Speed typing</span></p>
    </div>
  <canvas id="canvas" style="margin-top: 10vh; height: 80vh;overflow: hidden;"></canvas>
     <div class="container">
      <div class="test-container" >
      <main class="output"></main>
      <div class="timer"></div>
      <br><br><br>
      <div class="word-input">
        <input class="type-word" type="text" />
        <!--<button class="refresh">â†»</button>-->
        <div class="count-down">60</div>
      </div>

      <div class="result"></div>

      <div class="incorrect"></div>
      <!--<div>
        <p>
          Type as much fast as you can!!!
        </p>
      </div>-->
    </div>
  </div>
 
  <div class="mobile-only">
    <p class="apology">Sorry <span id="mobile-apology"></span>!</p>
    <h2>This is a desktop only webapp. Responsiveness is yet to be implemented.</h2>
  </div>
  <script>
      //canvas
     var canvas = document.getElementById("canvas");
     var ctx = canvas.getContext("2d");

     var width = 0;
     var height = 0;

     var iBubbles = 10;

     var aBubblesX = [];
     var aBubblesY = [];
     var aBubblesSize = [];
     var aBubblesSpeed = [];
     var aZeroOrOne = [];

     var random = (min, max) => {
         if (typeof max === "undefined") {
             return Math.random() * (min[1] - min[0]) + min[0];
         } else {
             return Math.random() * (max - min) + min;
         }
     };

     class NumberElementConfig {
         constructor(values, xMinMax, yMinMax, sizeMinMax, speedMinMax) {
             this.values = values;
             this.x = xMinMax;
             this.y = yMinMax;
             this.size = sizeMinMax;
             this.speed = speedMinMax;
         }
     }

     class NumberElement {
         constructor(numberElementConfig) {
             this.config = numberElementConfig;
             this.spawn();
         }

         spawn() {
             this.value = this.config.values[Math.floor(random(0, 2))];
             this.size = random(this.config.size);
             this.speed = random(this.config.speed);
             this.x = random(this.config.x);
             this.y = random(this.config.y);

             this.viewportOffset = this.config.size[1] + 20;

             if (Math.abs(this.speed) < 1) {
                 this.speed += this.speed < 0 ? -1 : 1;
             }

             this.setSpawnPosition();
         }

         respawn() {
             this.spawn();
         }

         setSpawnPosition() {
             if (this.speed < 0) {
                 let key = ["x", "y"][Math.floor(random(0, 2))];
                 let value = key === "x" ? innerWidth : innerHeight;
                 this[key] = value + this.size;
             } else {
                 let key = ["x", "y"][Math.floor(random(0, 2))];
                 this[key] = 0 - this.size;
             }
         }

         isInViewport() {
             if (
                 this.x < 0 - this.viewportOffset ||
                 this.y < 0 - this.viewportOffset ||
                 this.x > innerWidth + this.viewportOffset ||
                 this.y > innerHeight + this.viewportOffset
             ) {
                 return false;
             } else {
                 return true;
             }
         }

         move() {
             this.x += this.speed;
             this.y += this.speed;
         }
     }

     class NumberElementCollector {
         constructor(count = 10, spawnTimeout = 20) {
             this.numberElements = [];

             let generator = () => {
                 if (count != this.numberElements.length) {
                     this.numberElements.push(this.generateNumberElement());
                     setTimeout(generator, spawnTimeout);
                 }
             };
             generator();
         }

         get() {
             return this.numberElements;
         }

         moveAll() {
             for (let i = 0; i < this.numberElements.length; ++i) {
                 let element = this.numberElements[i];
                 element.move();
                 if (!element.isInViewport()) {
                     element.respawn();
                 }
             }
         }

         generateNumberElement() {
             return new NumberElement(
                 new NumberElementConfig(
                     ["0", "1"],
                     [0, innerWidth], // x
                     [0, innerHeight], // y
                     [15, 50], // size
                     [-12, 12] // speed
                 )
             );
         }
     }

     var numberElementCollector = new NumberElementCollector();

     var draw = () => {
         ctx.beginPath();
         ctx.fillStyle = "rgba(79, 155, 255, 0.7)";
         for (let numberElement of numberElementCollector.get()) {
             ctx.font = numberElement.size / 1.5 + "px arial black";
             ctx.textBaseline = "bottom";
             ctx.textAlign = "left";
             ctx.fillText(numberElement.value, numberElement.x, numberElement.y);
         }
         ctx.fillStyle = "rgba(0, 0, 0, 0.07)";
         ctx.fill();
         ctx.lineWidth = 1;
         ctx.strokeStyle = "rgba(0, 0, 0, 0.08)";
         ctx.stroke();
     };

     var process = () => {
         width = canvas.width = innerWidth;
         height = canvas.height = innerHeight;

         numberElementCollector.moveAll();
         draw();

         requestAnimationFrame(process);
     };
     process();

  </script>
  <script src="./app.js"></script>
  <footer class="fixed-bottom">
    &copy; 2022 Designed by &nbsp;<a class="a-text" href="https://github.com/tushar-prabhu" target="_blank">
      Tushar </a>&nbsp; for <i>&nbsp; IGNITRA-2K22</i>
  </footer>
</body>

</html>